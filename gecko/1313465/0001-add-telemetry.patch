From e214bf519df4ceed4c3871987e6f1663e56e3876 Mon Sep 17 00:00:00 2001
From: Wei-Cheng Pan <wpan@mozilla.com>
Date: Wed, 8 Feb 2017 15:11:53 +0800
Subject: [PATCH 1/2] add telemetry

---
 dom/events/EventDispatcher.cpp               | 4 ++++
 toolkit/components/telemetry/Histograms.json | 9 +++++++++
 2 files changed, 13 insertions(+)

diff --git a/dom/events/EventDispatcher.cpp b/dom/events/EventDispatcher.cpp
index 35d7db3e3500..f8ca174df837 100644
--- a/dom/events/EventDispatcher.cpp
+++ b/dom/events/EventDispatcher.cpp
@@ -626,6 +626,10 @@ EventDispatcher::Dispatch(nsISupports* aTarget,
   }
 #endif
 
+  if (auto inputEvent = aEvent->AsInputEvent()) {
+    Telemetry::AccumulateTimeDelta(Telemetry::INPUT_EVENT_RESPONSE_MS, inputEvent->mTimeStamp);
+  }
+
   nsCOMPtr<EventTarget> target = do_QueryInterface(aTarget);
 
   bool retargeted = false;
diff --git a/toolkit/components/telemetry/Histograms.json b/toolkit/components/telemetry/Histograms.json
index 5c0b882d7f70..d42678612828 100644
--- a/toolkit/components/telemetry/Histograms.json
+++ b/toolkit/components/telemetry/Histograms.json
@@ -10783,5 +10783,14 @@
     "bug_numbers": [1307689],
     "description": "Records a value each time a tab that is showing the loading throbber is interrupted. Desktop only.",
     "labels": ["stop", "back", "forward", "historyNavigation", "reload", "tabClosed", "newURI"]
+  },
+  "INPUT_EVENT_RESPONSE_MS": {
+    "alert_emails": ["wpan@mozilla.com"],
+    "expires_in_version": "never",
+    "kind": "exponential",
+    "high": 10000,
+    "n_buckets": 100,
+    "bug_numbers": [1313465],
+    "description": "Input event latency."
   }
 }
-- 
2.11.0

